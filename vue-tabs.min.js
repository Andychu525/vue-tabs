/**
 * vue-tabs v0.3.0
 * (c) 2017 ALEXQDJAY
 * mail: alexqdjay@126.com
 * @license Apache2
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueTaber=e()}(this,function(){"use strict";function t(t){return!!t&&"function"==typeof t}function e(t){return!!t&&"string"==typeof t}function n(t){return!!t&&"[object Object]"===Object.prototype.toString.call(t)}function a(t,e){if(void 0===e&&(e=""),n(t)){var a=t.name,o=t.key;return void 0===o&&(o=""),a+"/"+o}return t+"/"+e}function o(t){o.installed||(o.installed=!0,Object.defineProperty(t.prototype,"$taber",{get:function(){return this.$root._taber}}),Object.defineProperty(t.prototype,"$tab",{get:function(){return this.$options.$tab}}),u.methods.getVue=function(){return t},t.component("VueTabs",u),t.mixin({beforeCreate:function(){this.$options.taber?this._taber=this.$options.taber:this.$options.__taber&&(this._taber=this.$options.__taber)}}))}var s=function(t,e){t&&e&&(window.localStorage[t]=JSON.stringify(e))},i=function(t){var e=window.localStorage[t];return e?JSON.parse(e):null},r="$TABS",c="vue-tabs-active-change",l="vue-tabs-close",f={},u={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vue-tabs"},[n("div",{staticClass:"tabs-list-wrapper"},[n("ul",{staticClass:"tabs-list"},t._l(t.tabs,function(e,a){return n("tab",{key:a,attrs:{"tab-data":e},on:{close:function(n){t.close(e)}},nativeOn:{click:function(n){t.clickTab(e)}}})}))]),t._v(" "),n("div",{ref:"contentWrapEl",staticClass:"tabs-content-wrapper"})])},staticRenderFns:[],components:{Tab:{render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",{class:{active:t.tabData.active,loading:t.tabData.loading}},[t._v(t._s(t.tabData.meta.title)),n("span",{staticClass:"btn-close",on:{click:function(e){e.stopPropagation(),t.close(e)}}},[t._v("Ã—")])])},staticRenderFns:[],props:{tabData:Object},methods:{close:function(){this.$emit("close",this.tabData)}}}},data:function(){return{tabs:[],active:null}},beforeCreate:function(){this.tabSize=0,this.tabMap={}},created:function(){this.$taber.vm=this},mounted:function(){this.$taber.mounted()},methods:{appendContent:function(e){var n,a=f[e.name],o=this;if(a)n=Promise.resolve(a);else if(t(e.meta.component)){var s=e.meta.component;this.$set(e,"loading",!0),n=new Promise(s).then(function(t){return t.__esModule&&(t=t.default),f[e.name]=o.getVue().extend(t)})}else n=Promise.resolve(e.meta.component).then(function(t){return f[e.name]=o.getVue().extend(t)});return n.then(function(t){!function(t){var n=document.createElement("div");o.$refs.contentWrapEl.appendChild(n);var a=new t({el:n,__taber:o.$taber,parent:o,$tab:e});e.content=a,a.$el.classList.add("tabs-content")}(t)}),n},clickTab:function(t){t&&!t.active&&this.select(t)},close:function(e){function n(t){null==t&&o[++s].call(i,e,n)}if(e){var o=[].concat(this.$taber.beforeCloseHooks);e.meta.beforeClose&&t(e.meta.beforeClose)&&o.push(e.meta.beforeClose),o.push(function(){if(e.content.$destroy(),e.content.$el.remove)e.content.$el.remove();else{if(!e.content.$el.removeNode)throw"Element has no method named remove or removeNode";e.content.$el.removeNode(!0)}this.tabMap[a(e)]=null;var t=this.tabs.indexOf(e);-1!==t&&(this.tabs.splice(t,1),this.tabs.length>0&&this.active===e?t<this.tabs.length?this.select(this.tabs[t]):this.select(this.tabs[this.tabs.length-1]):0===this.tabs.length&&(this.$emit(c,null,e),this._saveTabs()),this.$emit(l,e))});var s=0,i=this;o[0].call(i,e,n)}},create:function(o){var s=this,i=[].concat(this.$taber.beforeCreateHooks);o.meta.beforeCreate&&t(o.meta.beforeCreate)&&i.push(o.meta.beforeCreate);var r=0,c=this,l=function(t){if(null==t)i[++r].call(c,o,l);else{if(!1===t)return;e(t)&&t===o.name?i[++r].call(c,o,l):n(t)&&t.name===o.name?i[++r].call(c,o,l):c.$taber.open(t)}};i.push(function(){s.tabs.push(o);var t=s.appendContent(o).then(function(){s.$set(o,"loading",!1)});o.promise=t,!1!==o.active?s.select(o):s._saveTabs();var e=a(o.name,o.key);s.tabMap[e]=o,l=null,i=null}),i[0].call(this,o,l)},findOpenTab:function(t,e){var n=a(t,e);return this.tabMap[n]},select:function(t){var e=this;if(t){this.$set(t,"active",!0),this.$emit(c,t,this.active),this.active=t,this.tabs.forEach(function(n){a(n.name,n.key)!==a(t.name,t.key)&&(e.$set(n,"active",!1),n.content&&n.content.$el&&n.content.$el.classList.remove("active"))}),this._saveTabs();var n=t.promise;n||(n=Promise.resolve()),n.then(function(){t.active&&t.content&&(t.content.$el.classList.add("active"),t.promise=null)})}},_saveTabs:function(){if(this.$taber.persist){var t=this.tabs.map(function(t){return{name:t.name,key:t.key,params:t.params,active:t.active}});s(r,t)}}}},h=["vue-tabs-close","vue-tabs-active-change"],p=function(t){var e=this,n=t.tabs,a=t.persist;this._tabsMap={},n.forEach(function(t){e._tabsMap[t.name]=t}),this.beforeCreateHooks=[],this.beforeCloseHooks=[],this._events={},this.persist=a},b={vm:{}};return p.prototype.findTab=function(t){if(!t)return null;var n;return n=e(t)?t:t.name,this._tabsMap[n]},p.prototype.open=function(t){e(t)&&(t={name:t});var n=this.findTab(t);if(n){t.meta=n;var a=this.vm.findOpenTab(t.name,t.key);a?this.vm.select(a):this.vm.create(t)}else console.error("The Tab ["+t.name+"] is not defined!")},p.prototype.close=function(t){e(t)&&(t={name:t});var n=this.findTab(t);if(n){t.meta=n;var a=this.vm.findOpenTab(t.name,t.key);this.vm.close(a)}else console.error("The Tab ["+t.name+"] is not defined!")},p.prototype.select=function(t){e(t)&&(t={name:t});var n=this.vm.findOpenTab(t.name,t.key);this.vm.select(n)},p.prototype.$on=function(e,n){e&&t(n)?(this._events[e]||(this._events[e]=[]),this._events[e].push(n)):console.error("$on error event:["+e+"], call:"+n)},p.prototype.$off=function(t,e){if(t){var n=this._events[t]||[];if(e){var a=n.indexOf(e);-1!==a&&n.splice(a,1)}else this._events[t]=[]}},p.prototype.beforeCreateEach=function(e){t(e)&&this.beforeCreateHooks.push(e)},p.prototype.beforeCloseEach=function(e){t(e)&&this.beforeCloseHooks.push(e)},p.prototype._restoreTabs=function(){var t=this;if(this.persist){var e=i(r);e&&e.forEach(function(e){t.open(e)})}},p.prototype.mounted=function(){this._restoreTabs()},b.vm.set=function(t){var e=this;this._vm=t;var n=this;h.forEach(function(a){t.$on(a,function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];(e._events[a]||[]).forEach(function(e){e.apply(n,t)})})})},b.vm.get=function(){return this._vm},Object.defineProperties(p.prototype,b),p.install=o,window.Vue&&window.Vue.use(p),p});